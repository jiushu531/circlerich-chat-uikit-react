"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var a=require("tslib"),e=require("./decodeText.js"),t=require("../../../constants.js"),o=require("tim-js-sdk/tim-js-friendship"),c=require("../../untils.js");function s(a){return a&&"object"==typeof a&&"default"in a?a:{default:a}}var n=s(o);function r(a){var e=a.split(".");return e[e.length-1]}function i(a){var e={},t={};try{e=c.JSONStringToParse(a.payload.data)}catch(a){e={}}if(1!==e.businessID)return"";try{t=c.JSONStringToParse(e.data)}catch(a){t={}}switch(e.actionType){case 1:return t.call_end>=0&&!e.groupID?"".concat(r("message.custom.talkTime"),"：").concat(l(t.call_end)):e.groupID?"".concat(r("message.custom.groupCallEnd")):t.data&&"switchToAudio"===t.data.cmd?"".concat(r("message.custom.switchToAudioCall")):t.data&&"switchToVideo"===t.data.cmd?"".concat(r("message.custom.switchToVideoCall")):"".concat(r("message.custom.all"));case 2:return"".concat(r("message.custom.cancel"));case 3:return t.data&&"switchToAudio"===t.data.cmd?"".concat(r("message.custom.switchToAudioCall")):t.data&&"switchToVideo"===t.data.cmd?"".concat(r("message.custom.switchToVideoCall")):"".concat(r("message.custom.accepted"));case 4:return"".concat(r("message.custom.rejected"));case 5:return t.data&&"switchToAudio"===t.data.cmd?"".concat(r("message.custom.switchToAudioCall")):t.data&&"switchToVideo"===t.data.cmd?"".concat(r("message.custom.switchToVideoCall")):"".concat(r("message.custom.noResp"));default:return""}}function l(a){var e,t,o,c,s=a;return s>=3600?(t=parseInt("".concat(s/3600),10)<10?"0".concat(parseInt("".concat(s/3600),10)):parseInt("".concat(s/3600),10),o=parseInt("".concat(s%60/60),10)<10?"0".concat(parseInt("".concat(s%60/60),10)):parseInt("".concat(s%60/60),10),(c=s%3600<10?"0".concat(s%3600):s%3600)>60&&(o=parseInt("".concat(c/60),10)<10?"0".concat(parseInt("".concat(c/60),10)):parseInt("".concat(c/60),10),c=c%60<10?"0".concat(c%60):c%60),e="".concat(t,":").concat(o,":").concat(c)):s>=60&&s<3600?(o=parseInt("".concat(s/60),10)<10?"0".concat(parseInt("".concat(s/60),10)):parseInt("".concat(s/60),10),c=s%60<10?"0".concat(s%60):s%60,e="00:".concat(o,":").concat(c)):s<60&&(c=s<10?"0".concat(s):s,e="00:00:".concat(c)),e}exports.extractCallingInfoFromMessage=i,exports.formatTime=l,exports.handleAudioMessageShowContext=function(a){return{progress:(null==a?void 0:a.status)===t.MESSAGE_STATUS.UNSEND&&a.progress,url:a.payload.url,message:a,second:a.payload.second}},exports.handleCustomMessageShowContext=function(a){return{message:a,custom:i(a)||(null==a?void 0:a.payload)||"[".concat(r("message.custom.custom"),"]")}},exports.handleFaceMessageShowContext=function(a){var e={message:a,name:"",url:""};return e.name=a.payload.data,a.payload.data.indexOf("@2x")<0&&(e.name="".concat(e.name,"@2x")),e.url="https://web.sdk.qcloud.com/im/assets/face-elem/".concat(e.name,".png"),e},exports.handleFileMessageShowContext=function(a){var e="";return e=a.payload.fileSize>=1048576?"".concat((a.payload.fileSize/1048576).toFixed(2)," Mb"):a.payload.fileSize>=1024?"".concat((a.payload.fileSize/1024).toFixed(2)," Kb"):"".concat(a.payload.fileSize.toFixed(2),"B"),{progress:(null==a?void 0:a.status)===t.MESSAGE_STATUS.UNSEND&&a.progress,url:a.payload.fileUrl,message:a,name:a.payload.fileName,size:e}},exports.handleImageMessageShowContext=function(a){return{progress:(null==a?void 0:a.status)===t.MESSAGE_STATUS.UNSEND&&a.progress,url:a.payload.imageInfoArray[1].url,message:a}},exports.handleLocationMessageShowContext=function(a){var e={lon:"",lat:"",href:"",url:"",description:"",message:a};return e.lon=a.payload.longitude.toFixed(6),e.lat=a.payload.latitude.toFixed(6),e.href="https://map.qq.com/?type=marker&isopeninfowin=1&markertype=1&"+"pointx=".concat(e.lon,"&pointy=").concat(e.lat,"&name=").concat(a.payload.description),e.url="https://apis.map.qq.com/ws/staticmap/v2/?"+"center=".concat(e.lat,",").concat(e.lon,"&zoom=10&size=300*150&maptype=roadmap&")+"markers=size:large|color:0xFFCCFF|label:k|".concat(e.lat,",").concat(e.lon,"&")+"key=UBNBZ-PTP3P-TE7DB-LHRTI-Y4YLE-VWBBD",e.description=a.payload.description,e},exports.handleMergerMessageShowContext=function(e){return a.__assign({message:e},e.payload)},exports.handleTextMessageShowContext=function(a){return{text:e.decodeText(a.payload)}},exports.handleTipMessageShowContext=function(a){var e,t,o,c,s,i={message:a,text:""},l=a.nick||(null===(e=null==a?void 0:a.payload)||void 0===e?void 0:e.userIDList.join(","));switch((null===(o=null===(t=null==a?void 0:a.payload)||void 0===t?void 0:t.memberList)||void 0===o?void 0:o.length)>0&&(l="",null===(s=null===(c=null==a?void 0:a.payload)||void 0===c?void 0:c.memberList)||void 0===s||s.map((function(a){return l+="".concat((null==a?void 0:a.nick)||(null==a?void 0:a.userID),","),a})),l=l.slice(0,-1)),a.payload.operationType){case n.default.TYPES.GRP_TIP_MBR_JOIN:i.text="".concat(l," ").concat(r("message.tip.加入群组"));break;case n.default.TYPES.GRP_TIP_MBR_QUIT:i.text="".concat(r("message.tip.群成员"),"：").concat(l," ").concat(r("message.tip.退出群组"));break;case n.default.TYPES.GRP_TIP_MBR_KICKED_OUT:i.text="".concat(r("message.tip.群成员"),"：").concat(l," ").concat(r("message.tip.被")).concat(a.payload.operatorID).concat(r("message.tip.踢出群组"));break;case n.default.TYPES.GRP_TIP_MBR_SET_ADMIN:i.text="".concat(r("message.tip.群成员"),"：").concat(l," ").concat(r("message.tip.成为管理员"));break;case n.default.TYPES.GRP_TIP_MBR_CANCELED_ADMIN:i.text="".concat(r("message.tip.群成员"),"：").concat(l," ").concat(r("message.tip.被撤销管理员"));break;case n.default.TYPES.GRP_TIP_GRP_PROFILE_UPDATED:i.text=function(a){var e=a.payload,t=e.newGroupProfile,o=e.operatorID,c="",s=Object.keys(t)[0];switch(s){case"muteAllMembers":c=t[s]?"".concat(r("message.tip.管理员")," ").concat(o," ").concat(r("message.tip.开启全员禁言")):"".concat(r("message.tip.管理员")," ").concat(o," ").concat(r("message.tip.取消全员禁言"));break;case"ownerID":c="".concat(t[s]," ").concat(r("message.tip.成为新的群主"));break;case"groupName":c="".concat(o," ").concat(r("message.tip.修改群名为")," ").concat(t[s]);break;case"notification":c="".concat(o," ").concat(r("message.tip.发布新公告"))}return c}(a);break;case n.default.TYPES.GRP_TIP_MBR_PROFILE_UPDATED:a.payload.memberList.map((function(a){return a.muteTime>0?i.text="".concat(r("message.tip.群成员"),"：").concat(a.userID).concat(r("message.tip.被禁言")):i.text="".concat(r("message.tip.群成员"),"：").concat(a.userID).concat(r("message.tip.被取消禁言")),a}));break;default:i.text="[".concat(r("message.tip.群提示消息"),"]")}return i},exports.handleVideoMessageShowContext=function(a){var e,o;return{progress:(null==a?void 0:a.status)===t.MESSAGE_STATUS.UNSEND&&(null==a?void 0:a.progress),url:null===(e=null==a?void 0:a.payload)||void 0===e?void 0:e.videoUrl,snapshotUrl:null===(o=null==a?void 0:a.payload)||void 0===o?void 0:o.snapshotUrl,message:a}},exports.translateGroupSystemNotice=function(a){var e=a.payload.groupProfile.name||a.payload.groupProfile.groupID;switch(a.payload.operationType){case 1:return"".concat(a.payload.operatorID," ").concat(r("message.tip.申请加入群组"),"：").concat(e);case 2:return"".concat(r("message.tip.成功加入群组"),"：").concat(e);case 3:return"".concat(r("message.tip.申请加入群组"),"：").concat(e," ").concat(r("message.tip.被拒绝"));case 4:return"".concat(r("message.tip.你被管理员")).concat(a.payload.operatorID," ").concat(r("message.tip.踢出群组"),"：").concat(e);case 5:return"".concat(r("message.tip.群"),"：").concat(e," ").concat(r("message.tip.被")," ").concat(a.payload.operatorID," ").concat(r("message.tip.解散"));case 6:return"".concat(a.payload.operatorID," ").concat(r("message.tip.创建群"),"：").concat(e);case 7:case 12:return"".concat(a.payload.operatorID," ").concat(r("message.tip.邀请你加群"),"：").concat(e);case 8:return"".concat(r("message.tip.你退出群组"),"：").concat(e);case 9:return"".concat(r("message.tip.你被")).concat(a.payload.operatorID," ").concat(r("message.tip.设置为群"),"：").concat(e," ").concat(r("message.tip.的管理员"));case 10:return"".concat(r("message.tip.你被")).concat(a.payload.operatorID," ").concat(r("message.tip.撤销群"),"：").concat(e," ").concat(r("message.tip.的管理员身份"));case 13:return"".concat(a.payload.operatorID," ").concat(r("message.tip.同意加群"),"：").concat(e);case 14:return"".concat(a.payload.operatorID," ").concat(r("message.tip.拒接加群"),"：").concat(e);case 255:return"".concat(r("message.tip.自定义群系统通知"),": ").concat(a.payload.userDefinedField);default:return""}};
