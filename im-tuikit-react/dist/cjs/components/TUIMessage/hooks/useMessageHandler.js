"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react"),r=require("../../../constants.js"),a=require("../../../context/TUIKitContext.js");require("react/jsx-runtime");var n=require("../../../context/TUIChatActionContext.js"),s=require("../../Toast/index.js");exports.useMessageHandler=function(o){var i=o.message,u=o.handleError,l=n.useTUIChatActionContext(),c=l.removeMessage,d=l.editLocalmessage,v=l.operateMessage,f=a.useTUIKitContext("useDeleteHandler").tim,p=t.useCallback((function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var r;return e.__generator(this,(function(e){switch(e.label){case 0:if(t.preventDefault(),!(null==i?void 0:i.ID)||!f||!c)return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,f.deleteMessage([i])];case 2:return e.sent(),c(i),[3,4];case 3:if(r=e.sent(),!u)throw s.Toast({text:"Error deleting message",type:"error"}),new Error(r);return u({functionName:"deleteMessage",error:r}),[3,4];case 4:return[2]}}))}))}),[i]),g=t.useCallback((function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var a,n;return e.__generator(this,(function(e){switch(e.label){case 0:if(t.preventDefault(),!(null==i?void 0:i.ID)||!f||!d)return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,f.revokeMessage(i)];case 2:return e.sent(),d(i),[3,4];case 3:if(a=e.sent(),!u)throw n=i.flow===r.MESSAGE_FLOW.OUT?"The message recall exceeded the time limit (default 2 minutes)":"Error revoke Message",s.Toast({text:n,type:"error"}),new Error(a);return u({functionName:"revokeMessage",error:a}),[3,4];case 4:return[2]}}))}))}),[i]),h=t.useCallback((function(e){var t;e.preventDefault(),(null==i?void 0:i.ID)&&f&&v&&v(((t={})[r.MESSAGE_OPERATE.QUOTE]=i,t))}),[i]),m=t.useCallback((function(e){if(e.preventDefault(),navigator.clipboard)navigator.clipboard.writeText(i.payload.text);else{var t=document.createElement("textarea");document.body.appendChild(t),t.style.position="fixed",t.style.clip="rect(0 0 0 0)",t.style.top="10px",t.value=i.payload.text,t.select(),document.execCommand("copy",!0),document.body.removeChild(t)}}),[i]),x=t.useCallback((function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var t,r,a;return e.__generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,f.resendMessage(i)];case 1:return t=e.sent(),d(null===(a=null==t?void 0:t.data)||void 0===a?void 0:a.message),[3,3];case 2:if(r=e.sent(),!u)throw s.Toast({text:r,type:"error"}),new Error(r);return u({functionName:"resendMessage",error:r}),[3,3];case 3:return[2]}}))}))}),[i]);return{handleDelMessage:p,handleRevokeMessage:g,handleReplyMessage:h,handleCopyMessage:m,handleResendMessage:x}};
