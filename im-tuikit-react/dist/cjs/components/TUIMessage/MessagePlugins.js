"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),s=require("react/jsx-runtime"),n=require("react"),t=require("../Plugins/index.js"),i=require("../Icon/Icon.js"),a=require("../Icon/type.js"),l=require("../../context/TUIChatStateContext.js"),r=require("../../context/TUIMessageContext.js"),u=require("./hooks/useMessageHandler.js"),o=require("tim-js-sdk/tim-js-friendship"),c=require("../../constants.js");require("date-fns");var g=require("./hooks/useMessagePluginElement.js");function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h=d(o);exports.MessagePlugins=function(o){var d=o.plugins,m=o.showNumber,p=void 0===m?0:m,M=o.MoreIcon,j=n.useState(""),x=j[0],S=j[1],E=n.useRef(null),I=r.useTUIMessageContext("MessagePlugins").message,T=l.useTUIChatStateContext("MessageBubbleWithContext").messageListRef,f=u.useMessageHandler({message:I}),_=f.handleDelMessage,y=f.handleRevokeMessage,v=f.handleReplyMessage,C=f.handleCopyMessage,P=f.handleResendMessage,q=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Revocation"}),s.jsx(i.Icon,{width:20,height:20,type:a.IconTypes.REVOCATION})]})),handle:function(e){E.current.closeMore(),y(e)},message:I}),N=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",e.__assign({className:"del"},{children:"Delete"})),s.jsx(i.Icon,{width:20,height:20,type:a.IconTypes.DEL})]})),handle:function(e){E.current.closeMore(),_(e)},message:I}),U=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Quote"}),s.jsx(i.Icon,{width:20,height:20,type:a.IconTypes.QUOTE})]})),handle:function(e){E.current.closeMore(),v(e)},message:I}),R=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Copy"}),s.jsx(i.Icon,{width:20,height:20,type:a.IconTypes.COPY})]})),handle:function(e){E.current.closeMore(),C(e)},message:I}),w=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Resend"}),s.jsx(i.Icon,{width:20,height:20,type:a.IconTypes.REPLY})]})),handle:function(e){E.current.closeMore(),P(e)},message:I}),A=(null==I?void 0:I.status)===c.MESSAGE_STATUS.SUCCESS?[U,N]:[w];(null==I?void 0:I.status)===c.MESSAGE_STATUS.SUCCESS&&I.flow===c.MESSAGE_FLOW.OUT&&(A=e.__spreadArray([q],A,!0)),I.type===h.default.TYPES.MSG_TEXT&&A.splice(-1,0,R);var b=d||A,O=M||s.jsx(i.Icon,{className:"icon-more",width:16,height:16,type:a.IconTypes.MORE});return(null==I?void 0:I.status)!==c.MESSAGE_STATUS.UNSEND&&s.jsx(t.Plugins,{className:"message-plugin",customClass:x,ref:E,plugins:b,showNumber:p,MoreIcon:O,root:null==T?void 0:T.current,handleVisible:function(e){S("".concat(!e.top&&"message-plugin-top"," ").concat(!e.left&&"message-plugin-left"))}})};
