"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react/jsx-runtime"),s=require("react"),i=require("../../context/TUIChatStateContext.js"),n=require("../../context/TUIChatActionContext.js"),r=require("../../context/ComponentContext.js"),o=require("./hooks/useEnrichedMessageList.js"),a=require("./hooks/useMessageListElement.js"),l=require("../InfiniteScrollPaginator/InfiniteScroll.js"),u=require("../EmptyStateIndicator/EmptyStateIndicator.js");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function d(c){var d=this,g=c.messageList,h=c.highlightedMessageId,m=c.loadMore,f=s.useState(null),I=f[0],v=f[1],x=s.useState(!1),M=x[0],j=x[1],_=i.useTUIChatStateContext("TUIMessageList"),p=_.messageList,C=_.highlightedMessageId,S=_.isCompleted,q=_.isSameLastMessageID,L=_.messageListRef,T=_.noMore,E=n.useTUIChatActionContext().loadMore,y=r.useComponentContext(),U=y.TUIMessage,b=y.EmptyStateIndicator,k=void 0===b?u.EmptyStateIndicator:b,w=h||C,N=o({messageList:g||p}).messageList,A=m||E,H=a({enrichedMessageList:N,TUIMessage:U});return s.useEffect((function(){e.__awaiter(d,void 0,void 0,(function(){var t,s,i,n,r,o;return e.__generator(this,(function(e){switch(e.label){case 0:return t=null===(o=null==I?void 0:I.parentElement)||void 0===o?void 0:o.parentElement,!S&&(null==t?void 0:t.clientHeight)>=(null==I?void 0:I.clientHeight)?[4,A()]:[3,2];case 1:e.sent(),e.label=2;case 2:return w&&(null==(s=null==I?void 0:I.querySelector("[data-message-id='".concat(w,"']")))||s.scrollIntoView({block:"center"})),!(null==I?void 0:I.children)||M&&q||(i=(null==I?void 0:I.children)||[],n=i[i.length-1],r=setTimeout((function(){null==n||n.scrollIntoView({block:"end"}),j(!0),clearTimeout(r)}),100)),[2]}}))}))}),[H,M]),t.jsxs("div",e.__assign({className:"message-list",ref:L},{children:[T,T&&t.jsx("p",e.__assign({className:"no-more"},{children:"no More"})),t.jsx(l.InfiniteScroll,e.__assign({className:"message-list-infinite-scroll",hasMore:!0,loadMore:A,threshold:1},{children:t.jsx("ul",e.__assign({ref:v},{children:(null==H?void 0:H.length)>0?H:t.jsx(k,{listType:"message"})}))}))]}))}var g=c(s).default.memo(d);exports.TUIMessageList=function(s){return t.jsx(g,e.__assign({},s))};
