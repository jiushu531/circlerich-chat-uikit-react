import{__awaiter as e,__generator as t}from"tslib";import{useCallback as r}from"react";import{MESSAGE_FLOW as n,MESSAGE_OPERATE as o}from"../../../constants.js";import{useTUIKitContext as s}from"../../../context/TUIKitContext.js";import"react/jsx-runtime";import{useTUIChatActionContext as a}from"../../../context/TUIChatActionContext.js";import{Toast as i}from"../../Toast/index.js";var l=function(l){var u=l.message,c=l.handleError,d=a(),m=d.removeMessage,v=d.editLocalmessage,f=d.operateMessage,p=s("useDeleteHandler").tim,h=r((function(r){return e(void 0,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:if(r.preventDefault(),!(null==u?void 0:u.ID)||!p||!m)return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,p.deleteMessage([u])];case 2:return t.sent(),m(u),[3,4];case 3:if(e=t.sent(),!c)throw i({text:"Error deleting message",type:"error"}),new Error(e);return c({functionName:"deleteMessage",error:e}),[3,4];case 4:return[2]}}))}))}),[u]),g=r((function(r){return e(void 0,void 0,void 0,(function(){var e,o;return t(this,(function(t){switch(t.label){case 0:if(r.preventDefault(),!(null==u?void 0:u.ID)||!p||!v)return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,p.revokeMessage(u)];case 2:return t.sent(),v(u),[3,4];case 3:if(e=t.sent(),!c)throw o=u.flow===n.OUT?"The message recall exceeded the time limit (default 2 minutes)":"Error revoke Message",i({text:o,type:"error"}),new Error(e);return c({functionName:"revokeMessage",error:e}),[3,4];case 4:return[2]}}))}))}),[u]),x=r((function(e){var t;e.preventDefault(),(null==u?void 0:u.ID)&&p&&f&&f(((t={})[o.QUOTE]=u,t))}),[u]),y=r((function(e){if(e.preventDefault(),navigator.clipboard)navigator.clipboard.writeText(u.payload.text);else{var t=document.createElement("textarea");document.body.appendChild(t),t.style.position="fixed",t.style.clip="rect(0 0 0 0)",t.style.top="10px",t.value=u.payload.text,t.select(),document.execCommand("copy",!0),document.body.removeChild(t)}}),[u]),M=r((function(r){return e(void 0,void 0,void 0,(function(){var e,r,n;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,p.resendMessage(u)];case 1:return e=t.sent(),v(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.message),[3,3];case 2:if(r=t.sent(),!c)throw i({text:r,type:"error"}),new Error(r);return c({functionName:"resendMessage",error:r}),[3,3];case 3:return[2]}}))}))}),[u]);return{handleDelMessage:h,handleRevokeMessage:g,handleReplyMessage:x,handleCopyMessage:y,handleResendMessage:M}};export{l as useMessageHandler};
