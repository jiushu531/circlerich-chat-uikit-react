import{__assign as e,__spreadArray as s}from"tslib";import{jsxs as t,jsx as n}from"react/jsx-runtime";import{useState as i,useRef as o}from"react";import{Plugins as l}from"../Plugins/index.js";import{Icon as a}from"../Icon/Icon.js";import{IconTypes as r}from"../Icon/type.js";import{useTUIChatStateContext as m}from"../../context/TUIChatStateContext.js";import{useTUIMessageContext as c}from"../../context/TUIMessageContext.js";import{useMessageHandler as h}from"./hooks/useMessageHandler.js";import d from"tim-js-sdk/tim-js-friendship";import{MESSAGE_STATUS as g,MESSAGE_FLOW as p}from"../../constants.js";import"date-fns";import{useMessagePluginElement as u}from"./hooks/useMessagePluginElement.js";function f(f){var M=f.plugins,v=f.showNumber,C=void 0===v?0:v,N=f.MoreIcon,j=i(""),y=j[0],E=j[1],S=o(null),w=c("MessagePlugins").message,R=m("MessageBubbleWithContext").messageListRef,x=h({message:w}),I=x.handleDelMessage,T=x.handleRevokeMessage,U=x.handleReplyMessage,b=x.handleCopyMessage,O=x.handleResendMessage,P=u({children:t("div",e({className:"message-plugin-item"},{children:[n("span",{children:"Revocation"}),n(a,{width:20,height:20,type:r.REVOCATION})]})),handle:function(e){S.current.closeMore(),T(e)},message:w}),k=u({children:t("div",e({className:"message-plugin-item"},{children:[n("span",e({className:"del"},{children:"Delete"})),n(a,{width:20,height:20,type:r.DEL})]})),handle:function(e){S.current.closeMore(),I(e)},message:w}),D=u({children:t("div",e({className:"message-plugin-item"},{children:[n("span",{children:"Quote"}),n(a,{width:20,height:20,type:r.QUOTE})]})),handle:function(e){S.current.closeMore(),U(e)},message:w}),L=u({children:t("div",e({className:"message-plugin-item"},{children:[n("span",{children:"Copy"}),n(a,{width:20,height:20,type:r.COPY})]})),handle:function(e){S.current.closeMore(),b(e)},message:w}),Y=u({children:t("div",e({className:"message-plugin-item"},{children:[n("span",{children:"Resend"}),n(a,{width:20,height:20,type:r.REPLY})]})),handle:function(e){S.current.closeMore(),O(e)},message:w}),Q=(null==w?void 0:w.status)===g.SUCCESS?[D,k]:[Y];(null==w?void 0:w.status)===g.SUCCESS&&w.flow===p.OUT&&(Q=s([P],Q,!0)),w.type===d.TYPES.MSG_TEXT&&Q.splice(-1,0,L);var V=M||Q,A=N||n(a,{className:"icon-more",width:16,height:16,type:r.MORE});return(null==w?void 0:w.status)!==g.UNSEND&&n(l,{className:"message-plugin",customClass:y,ref:S,plugins:V,showNumber:C,MoreIcon:A,root:null==R?void 0:R.current,handleVisible:function(e){E("".concat(!e.top&&"message-plugin-top"," ").concat(!e.left&&"message-plugin-left"))}})}export{f as MessagePlugins};
