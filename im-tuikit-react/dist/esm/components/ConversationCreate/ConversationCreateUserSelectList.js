import{__assign as e,__awaiter as t,__generator as r,__spreadArray as n}from"tslib";import{jsxs as i,Fragment as o,jsx as c}from"react/jsx-runtime";import{useState as a,useRef as s}from"react";import{Input as u}from"../Input/Input.js";import{Icon as l}from"../Icon/Icon.js";import{IconTypes as m}from"../Icon/type.js";import{ConversationCreateSelectView as p}from"./ConversationCreateSelectView.js";import{Avatar as d}from"../Avatar/Avatar.js";import{useConversationCreate as h}from"./hooks/useConversationCreate.js";import{useTUIKitContext as v}from"../../context/TUIKitContext.js";import{PageStateTypes as f}from"./ConversationCreate.js";import{useConversation as C}from"../../hooks/useConversation.js";import{Toast as N}from"../Toast/index.js";function g(g){var x=this,k=g.isCreateGroup,I=g.selectList,b=g.setSelectList,j=g.className,y=g.conversationList,L=g.setIsCreateGroup,S=g.setConversationCreated,A=g.setPageState,D=a(""),w=D[0],E=D[1],T=v(),G=T.tim,R=T.setActiveConversation,F=a({}),P=F[0],z=F[1],H=h(G,y,(function(e){z(e)})).getFriendListSortSearchResult,K=C(G).createConversation,M=s(new Map);return i(o,{children:[c(u,{className:"tui-conversation-create-search-input",placeholder:"Search",clearable:!0,value:w,onChange:function(e){return t(x,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return t=e.target.value,E(t),n=z,[4,H(t)];case 1:return n.apply(void 0,[r.sent()]),[2]}}))}))},prefix:c(l,{type:m.SEARCH,height:16,width:16})}),k&&c(p,{selectList:I,setSelectList:b}),!k&&i("div",e({role:"presentation",className:"tui-user",onClick:function(){L(!0),M.current.clear(),b([])}},{children:[c(l,{type:m.ADD}),c("div",e({className:"tui-user-name active"},{children:"New Group"}))]})),c("div",e({className:"tui-conversation-create ".concat(j)},{children:c("div",e({className:"tui-conversation-create-container"},{children:c("div",e({className:"tui-group-container"},{children:Object.keys(P).map((function(o){return 0!==P[o].length&&i("div",e({className:"tui-group-box"},{children:[c("div",e({className:"title"},{children:o})),P[o].map((function(a,s){var u=a.userID,l=a.nick,m=a.avatar;return i("label",e({role:"presentation",className:"tui-user tui-user-checkbox-label",htmlFor:"userChecked-".concat(o,"-").concat(u),onClick:function(e){!function(e){t(x,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return k?[2]:(t=e.userID,[4,K("C2C".concat(t))]);case 1:return n=r.sent(),S(!1),R(n),[2]}}))}))}(a)}},{children:[c(d,{size:30,image:m}),c("div",e({className:"tui-user-name"},{children:l||"".concat(u)})),k&&c("input",{onChange:function(e){!function(e,t,r){void 0===r&&(r=[]);var i=t.userID,o=e.target.checked;r.forEach((function(e){e.checked=o})),o?I.push({profile:t,domList:r}):I.splice(I.findIndex((function(e){return e.profile.userID===i})),1),b(n([],I,!0))}(e,a,M.current.get(u))},type:"checkbox",ref:function(e){!function(e,t){if(t){M.current.has(e)||M.current.set(e,[]);var r=M.current.get(e);0!==r.length&&r.some((function(e){return e.id===t.id}))||r.push(t)}}(u,e)},id:"userChecked-".concat(o,"-").concat(u),className:"tui-user-checkbox"})]}),u)}))]}),o)}))}))}))})),k&&c("div",e({className:"tui-conversation-create-next-container"},{children:c("div",e({role:"presentation",className:"tui-conversation-create-next",onClick:function(){I&&0===I.length?N({text:"Participant cannot be empty.",type:"error"}):A(f.CREATE_DETAIL)}},{children:"Next"}))}))]})}export{g as ConversationCreateUserSelectList};
