import{__assign as e,__awaiter as t,__generator as o}from"tslib";import{jsx as s,jsxs as i}from"react/jsx-runtime";import n,{useState as r,useEffect as l}from"react";import{useTUIChatStateContext as a}from"../../context/TUIChatStateContext.js";import{useTUIChatActionContext as m}from"../../context/TUIChatActionContext.js";import{useComponentContext as c}from"../../context/ComponentContext.js";import d from"./hooks/useEnrichedMessageList.js";import u from"./hooks/useMessageListElement.js";import{InfiniteScroll as h}from"../InfiniteScrollPaginator/InfiniteScroll.js";import{EmptyStateIndicator as g}from"../EmptyStateIndicator/EmptyStateIndicator.js";function f(n){var f=this,p=n.messageList,v=n.highlightedMessageId,I=n.loadMore,M=r(null),L=M[0],j=M[1],x=r(!1),S=x[0],T=x[1],C=a("TUIMessageList"),E=C.messageList,b=C.highlightedMessageId,y=C.isCompleted,U=C.isSameLastMessageID,k=C.messageListRef,w=C.noMore,N=m().loadMore,H=c(),V=H.TUIMessage,q=H.EmptyStateIndicator,A=void 0===q?g:q,D=v||b,P=d({messageList:p||E}).messageList,R=I||N,z=u({enrichedMessageList:P,TUIMessage:V});return l((function(){t(f,void 0,void 0,(function(){var e,t,s,i,n,r;return o(this,(function(o){switch(o.label){case 0:return e=null===(r=null==L?void 0:L.parentElement)||void 0===r?void 0:r.parentElement,!y&&(null==e?void 0:e.clientHeight)>=(null==L?void 0:L.clientHeight)?[4,R()]:[3,2];case 1:o.sent(),o.label=2;case 2:return D&&(null==(t=null==L?void 0:L.querySelector("[data-message-id='".concat(D,"']")))||t.scrollIntoView({block:"center"})),!(null==L?void 0:L.children)||S&&U||(s=(null==L?void 0:L.children)||[],i=s[s.length-1],n=setTimeout((function(){null==i||i.scrollIntoView({block:"end"}),T(!0),clearTimeout(n)}),100)),[2]}}))}))}),[z,S]),i("div",e({className:"message-list",ref:k},{children:[w,w&&s("p",e({className:"no-more"},{children:"no More"})),s(h,e({className:"message-list-infinite-scroll",hasMore:!0,loadMore:R,threshold:1},{children:s("ul",e({ref:j},{children:(null==z?void 0:z.length)>0?z:s(A,{listType:"message"})}))}))]}))}var p=n.memo(f);function v(t){return s(p,e({},t))}export{v as TUIMessageList};
